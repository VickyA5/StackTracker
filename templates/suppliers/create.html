{% extends 'base.html' %}

{% block title %}Add Supplier{% endblock %}

{% block content %}
  <h2>Add Supplier</h2>
  <p class="subtitle">Enter column names exactly as they appear in your stock Excel, and upload an initial Excel to use as the baseline for future comparisons.</p>
  <p class="subtitle" style="margin:6px 0 16px;">Minimum required: <em>Product ID</em>. Optional: <em>Stock</em>, <em>Price</em>, and <em>Name/Description</em>. If stock uses text (e.g., "IN STOCK" / "OUT OF STOCK"), choose <em>Text (strings)</em> and provide the strings.</p>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="vstack">
      {{ form.name.label_tag }}
      {{ form.name }}

      {{ form.product_id_column.label_tag }}
      {{ form.product_id_column }}

      {{ form.product_name_column.label_tag }}
      {{ form.product_name_column }}

      {{ form.stock_column.label_tag }}
      {{ form.stock_column }}

      <div style="margin-top:8px;">
        <label style="display:block; margin-bottom:6px;">Stock value type</label>
        <div style="display:flex; gap:12px;">
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="radio" name="stock_value_type" value="numeric" checked>
            <span>Numeric</span>
          </label>
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="radio" name="stock_value_type" value="text">
            <span>Text (strings)</span>
          </label>
        </div>
        <p class="muted" style="margin-top:6px;">Choose whether the stock column has numbers or text like "IN STOCK" / "OUT OF STOCK".</p>
      </div>

      <div id="text-stock-config" style="display:none; margin-top:8px;">
        {{ form.stock_in_text.label_tag }}
        {{ form.stock_in_text }}
        {{ form.stock_out_text.label_tag }}
        {{ form.stock_out_text }}
        <p class="muted" style="margin-top:6px;">When using text, values are mapped as: In Stock → 1, Out of Stock → 0. Numeric values are used as-is if present.</p>
      </div>

      {{ form.price_column.label_tag }}
      {{ form.price_column }}

      {{ form.current_file.label_tag }}
      {{ form.current_file }}
      {% if form.current_file.errors %}
        <div class="field-errors">{{ form.current_file.errors|striptags }}</div>
      {% endif %}

      <div class="actions" style="display:flex; gap:12px; margin-top:12px; width:100%;">
        <button class="btn" type="submit" style="flex:1; min-width:0; text-align:center;">Create</button>
        <a class="btn secondary" href="{% url 'home' %}" style="flex:1; min-width:0; text-align:center; display:inline-flex; align-items:center; justify-content:center;">Back</a>
      </div>
    </div>
  </form>

  <script>
    (function() {
      const radios = document.querySelectorAll('input[name="stock_value_type"]');
      const textCfg = document.getElementById('text-stock-config');
      function update() {
        const val = Array.from(radios).find(r => r.checked)?.value;
        textCfg.style.display = (val === 'text') ? 'block' : 'none';
      }
      radios.forEach(r => r.addEventListener('change', update));
      update();
    })();
  </script>
{% endblock %}
